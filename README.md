# Code Review Agent ü§ñ

An intelligent AI-powered code review agent that analyzes git changes, provides detailed feedback, generates conventional commit messages, and documents findings in markdown files.

## üöÄ Features

- **Automated Code Review**: Analyzes git diffs and provides expert-level feedback
- **Commit Message Generation**: Creates conventional commit messages based on changes
- **Markdown Documentation**: Saves review findings to structured markdown files
- **Multiple Review Areas**: Covers correctness, clarity, maintainability, consistency, performance, security, testing, and scalability
- **AI-Powered**: Uses Google's Gemini 2.5 Flash model for intelligent analysis

## üìã Prerequisites

- **Node.js** (v18 or higher)
- **Bun** runtime
- **Git** repository with changes to review
- **Google AI API key** (for Gemini model access)

## üõ†Ô∏è Installation

1. **Clone the repository**:
   ```bash
   git clone <repository-url>
   cd code-review-agent
   ```

2. **Install dependencies**:
   ```bash
   bun install
   ```

3. **Set up environment variables**:
   Create a `.env` file or set environment variables for your Google AI API key:
   ```bash
   export GOOGLE_AI_API_KEY="your-api-key-here"
   ```

## üéØ Quick Start

### Basic Usage

1. **Navigate to your project directory**:
   ```bash
   cd /path/to/your/project
   ```

2. **Make some changes and stage them**:
   ```bash
   git add .
   ```

3. **Run the Code Review Agent**:
   ```bash
   cd /path/to/code-review-agent
   bun run index.ts
   ```

### Custom Review

Edit the prompt in `index.ts` to customize the review:

```typescript
await codeReviewAgent(
  "Review the code changes in '../my-project' directory, generate a commit message, and save the review to 'review-report.md'"
);
```

## üîß Available Tools

### 1. File Changes Analysis (`getFileChangesInDirectoryTool`)

**Purpose**: Retrieves and analyzes git diffs for all changed files in a directory.

**Example Usage**:
```typescript
await codeReviewAgent(
  "Analyze the changes in '../my-project' directory"
);
```

**What it does**:
- Scans for modified, added, and deleted files
- Retrieves detailed git diffs
- Excludes build artifacts and lock files
- Provides comprehensive change overview

### 2. Commit Message Generation (`generateCommitMessageTool`)

**Purpose**: Generates conventional commit messages based on the analyzed changes.

**Example Usage**:
```typescript
await codeReviewAgent(
  "Generate a commit message for the changes in '../my-project'"
);
```

**Features**:
- **Auto-detection** of commit types:
  - `feat`: New features or functionality
  - `fix`: Bug fixes and corrections
  - `docs`: Documentation updates
  - `test`: Test additions or modifications
  - `refactor`: Code restructuring
  - `style`: Formatting changes
  - `chore`: Maintenance tasks
- **Smart scoping** based on modified files
- **Detailed statistics** (insertions, deletions, files changed)
- **Conventional commits** format compliance

**Sample Output**:
```
feat(auth): add user authentication system

Changes:
- 5 file(s) modified
- +234 insertions, -12 deletions

Files changed:
- src/auth/login.ts
- src/auth/register.ts
- src/middleware/auth.ts
- tests/auth.test.ts
- README.md
```

### 3. Markdown Documentation (`writeToMarkdownFileTool`)

**Purpose**: Creates structured markdown files with review findings.

**Example Usage**:
```typescript
await codeReviewAgent(
  "Review the changes and save the report to './reviews/latest-review.md'"
);
```

**Generated Structure**:
```markdown
# Code Review Report

Generated on: [timestamp]

---

## Summary
[Overall assessment]

## File-by-File Analysis
[Detailed review of each changed file]

## Recommendations
[Actionable suggestions]

## Commit Suggestion
[Generated commit message]

---

*Generated by Code Review Agent*
```

## üìÅ Project Structure

```
code-review-agent/
‚îú‚îÄ‚îÄ index.ts           # Main agent entry point
‚îú‚îÄ‚îÄ tools.ts           # Tool implementations
‚îú‚îÄ‚îÄ prompt.ts          # System prompt configuration
‚îú‚îÄ‚îÄ package.json       # Dependencies and scripts
‚îú‚îÄ‚îÄ tsconfig.json      # TypeScript configuration
‚îú‚îÄ‚îÄ README.md          # This file
‚îú‚îÄ‚îÄ FEATURES.md        # Detailed feature documentation
‚îî‚îÄ‚îÄ bun.lock          # Dependency lock file
```

## üé® Customization

### Modifying the System Prompt

Edit `prompt.ts` to customize the agent's behavior:

```typescript
export const SYSTEM_PROMPT = `
// Add your custom instructions here
// Modify review focus areas
// Adjust communication style
`;
```

### Adding Custom Tools

1. **Define the tool schema** in `tools.ts`:
   ```typescript
   const myCustomTool = z.object({
     param1: z.string().describe("Description"),
     param2: z.number().optional(),
   });
   ```

2. **Implement the tool function**:
   ```typescript
   async function myCustomFunction({ param1, param2 }: MyCustomType) {
     // Your implementation here
     return result;
   }
   ```

3. **Export the tool**:
   ```typescript
   export const myCustomTool = tool({
     description: "What this tool does",
     inputSchema: myCustomTool,
     execute: myCustomFunction,
   });
   ```

4. **Add to agent** in `index.ts`:
   ```typescript
   tools: {
     getFileChangesInDirectoryTool,
     generateCommitMessageTool,
     writeToMarkdownFileTool,
     myCustomTool, // Add your tool here
   },
   ```

## üí° Usage Examples

### Example 1: Complete Code Review Workflow

```typescript
await codeReviewAgent(`
  Please perform a comprehensive code review on the changes in '../my-web-app' directory.
  
  Steps:
  1. Analyze all changed files
  2. Provide detailed feedback on code quality, security, and performance
  3. Generate an appropriate conventional commit message
  4. Save the complete review to './reviews/web-app-review-2024-09-16.md'
`);
```

### Example 2: Quick Commit Message Generation

```typescript
await codeReviewAgent(`
  Generate a conventional commit message for the changes in '../api-server' directory.
  Focus on the type of changes and provide a clear, concise message.
`);
```

### Example 3: Security-Focused Review

```typescript
await codeReviewAgent(`
  Review the changes in '../payment-service' directory with special attention to:
  - Security vulnerabilities
  - Input validation
  - Authentication and authorization
  - Data handling practices
  
  Save the security review to './security-reviews/payment-service-review.md'
`);
```

### Example 4: Documentation Review

```typescript
await codeReviewAgent(`
  Review the documentation changes in '../docs' directory.
  Check for:
  - Clarity and readability
  - Completeness of information
  - Proper formatting and structure
  - Accuracy of code examples
`);
```

## üîç Review Focus Areas

The agent analyzes code changes across multiple dimensions:

1. **Correctness**: Logic errors, bugs, edge cases
2. **Clarity**: Readability, naming conventions, structure
3. **Maintainability**: Code complexity, duplication, coupling
4. **Consistency**: Coding standards, patterns, formatting
5. **Performance**: Inefficiencies, bottlenecks, optimization
6. **Security**: Vulnerabilities, input validation, safe practices
7. **Testing**: Coverage, test quality, reliability
8. **Scalability**: Error handling, robustness, scale considerations

## üö® Troubleshooting

### Common Issues

1. **API Key Issues**:
   ```bash
   Error: Google AI API key not found
   ```
   **Solution**: Set your `GOOGLE_AI_API_KEY` environment variable

2. **Git Repository Not Found**:
   ```bash
   Error: Not a git repository
   ```
   **Solution**: Ensure you're running the agent on a directory with git initialized

3. **No Changes Detected**:
   ```bash
   No changes found in the repository
   ```
   **Solution**: Make sure you have staged or unstaged changes in your git repository

4. **Permission Errors**:
   ```bash
   Error: Permission denied writing to file
   ```
   **Solution**: Check file permissions and ensure the target directory exists

### Debug Mode

To see detailed output, you can modify the agent to log intermediate steps:

```typescript
// Add logging in index.ts
console.log("Starting code review...");
for await (const chunk of result.textStream) {
  process.stdout.write(chunk);
}
console.log("\nCode review completed!");
```

## ü§ù Contributing

1. Fork the repository
2. Create a feature branch: `git checkout -b feature-name`
3. Make your changes
4. Test thoroughly
5. Commit with conventional commits: `git commit -m "feat: add new feature"`
6. Push and create a pull request

## üìÑ License

This project is licensed under the MIT License - see the LICENSE file for details.

## üôè Acknowledgments

- Built with [AI SDK](https://sdk.vercel.ai/) by Vercel
- Powered by [Google's Gemini](https://ai.google.dev/) AI model
- Uses [simple-git](https://github.com/steveukx/git-js) for git operations
- TypeScript validation with [Zod](https://zod.dev/)

---

**Happy Code Reviewing! üéâ**

For more detailed information about the features and implementation, see [FEATURES.md](FEATURES.md).
